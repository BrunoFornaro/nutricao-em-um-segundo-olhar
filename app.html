<!DOCTYPE html>
<html>

<head>
    <!-- Link com o repositório do projeto no observable: https://observablehq.com/d/ffb89fcb60d326fa -->
    <!-- Nome na aba do navegador -->
    <title>Nutrição em um olhar</title>
    <!-- Logo na aba do navegador (gerada pela IA do Canva) -->
    <link rel="shortcut icon" href="img/logo.png" type="image/x-icon">
    <!-- Import o D3 -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <!-- Import o Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
        integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
        integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
        integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <!-- Folha de estilos -->
    <link rel="stylesheet" href="style.css">
    <!-- Fontes -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;1,300;1,400;1,500;1,600;1,700;1,800&display=swap"
        rel="stylesheet">




    <!-- Importar scripts do Firebase -->
    <script type="module">
        const DEBUG = false;

        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-analytics.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyAhS7zhyXHLNGLpQ9saPZZg8Aol8jWaGPA",
            authDomain: "nutricao-em-um-olhar.firebaseapp.com",
            projectId: "nutricao-em-um-olhar",
            storageBucket: "nutricao-em-um-olhar.appspot.com",
            messagingSenderId: "101019466395",
            appId: "1:101019466395:web:d22a7fda84e635e544243e",
            measurementId: "G-MNX0D151MB"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const auth = getAuth();
        const db = getFirestore(app);

        // Dados dos alimentos
        var data = await readCSV("archive/tabela.csv");

        // Dicionário que relaciona o nome do alimento com seu índice
        var food_indexes = {}
        for (var i in data) {
            food_indexes[data[i]["Nome"]] = i;
        }
        var nutritional_columns = [
            "Saturados (g)",
            "Monoinsaturados (g)",
            "Poliinsaturados (g)",
            "Manganês (mg)",
            "Fósforo (mg)",
            "Ferro (mg)",
            "Sódio (mg)",
            "Cobre (mg)",
            "Zinco (mg)",
            "Retinol(µg)",
            "Tiamina (mg)",
            "Riboflavina (mg)",
            "Piridoxina (mg)",
            "Niacina (mg)",
            "Vitamina C (mg)",
            "Umidade (%)",
            "Energia (kcal)",
            "Energia (kJ)",
            "Proteína (g)",
            "Lipídeos (g)",
            "Colesterol (mg)",
            "Carboidrato (g)",
            "Fibra Alimentar (g)",
            "Cinzas (g)",
            "Cálcio (mg)",
            "Magnésio (mg)"
        ];

        // Recupera o usuário atual (salvo no local storage)
        var user_uid = localStorage.getItem('user');
        if (DEBUG) {
            console.log(user_uid);
        }

        // Faz um click automático na tela
        // Obtém uma referência para o botão
        var button = document.getElementById('menos_alimentos');

        // Cria um evento de clique
        var clickEvent = new MouseEvent('click', {
        bubbles: true,
        cancelable: true,
        view: window
        });

        // Simula o clique no botão
        button.dispatchEvent(clickEvent);


        const confirmar_elemente = document.getElementById('confirmar');
        confirmar_elemente.addEventListener('click', confirmar);

        // Ids dos campos em objetivos
        var fieldIds = [
            "weight",
            "last_weight",
            "daily_calories",
            "carbs_percent",
            "lipids_percent",
            "protein_percent",
            "tolerance",
            "num_daily_plates"
        ];

        // Recupera os dados do usuário
        const docRef = doc(db, "user_info", user_uid);
        getDoc(docRef)
            .then((docSnap) => {
                // Recupera os dados do documento (testes)
                if (docSnap.exists()) {
                    if (docSnap.data()["initial"] == false) {
                        fieldIds.forEach(function (fieldId) {
                            // Define o valor do elemento como o valor no banco de dados
                            document.getElementById(fieldId).value = docSnap.data()[fieldId];
                        });
                    }
                } else {
                    console.log("No such document!");
                }
            })
            .catch((error) => {
                console.error("Erro ao recuperar os dados:", error);
            });



        function confirmar() {
            var data = {};

            fieldIds.forEach(function (fieldId) {
                var value = parseInt(document.getElementById(fieldId).value);
                if (isNaN(value)) {
                    var placeholder = document.getElementById(fieldId).placeholder;
                    data[fieldId] = placeholder;
                } else {
                    data[fieldId] = value;
                }
            });

            // Pega o peso do usuário


            // Cria (ou atualiza) o documento para o usuário no Firestore (atual)
            setDoc(doc(db, "user_info", user_uid), {
                weight: data["weight"],
                last_weight: data["last_weight"],
                daily_calories: data["daily_calories"],
                carbs_percent: data["carbs_percent"],
                lipids_percent: data["lipids_percent"],
                protein_percent: data["protein_percent"],
                tolerance: data["tolerance"],
                num_daily_plates: data["num_daily_plates"],
                initial: 0
            })
                .then(() => {
                    console.log("Documento atualizado com sucesso!");
                })
                .catch((error) => {
                    // Ocorreu um erro ao gravar no Firestore
                    console.error("Erro ao criar o documento: ", error);
                });

            // Cria (ou atualiza) o documento para o usuário no Firestore (histórico)
            setDoc(doc(db, user_uid, curr_date_formated(), "user_info", "info"), {
                weight: data["weight"],
                last_weight: data["last_weight"],
                daily_calories: data["daily_calories"],
                carbs_percent: data["carbs_percent"],
                lipids_percent: data["lipids_percent"],
                protein_percent: data["protein_percent"],
                tolerance: data["tolerance"],
                num_daily_plates: data["num_daily_plates"],
                initial: 0
            })
                .then(() => {
                    console.log("Documento atualizado com sucesso!");
                })
                .catch((error) => {
                    // Ocorreu um erro ao gravar no Firestore
                    console.error("Erro ao criar o documento: ", error);
                });

        }

        // Botão de confirmar o prato
        const confirmar_prato = document.getElementById('confirmar_prato');

        // Adiciona um evento de clique ao botão de confirmar prato
        confirmar_prato.addEventListener('click', async function () {
            // Obtém a quantidade de alimentos no prato
            var qtd_alimentos = document.getElementsByClassName('filtro_textual').length;

            // Função assíncrona para recuperar o número de pratos do dia
            async function getNumberOfPlates() {
                var num_pratos = 0;
                var stop = false;

                while (!stop) {
                    //   console.log("Entrou no loop");

                    try {
                        var docRef = doc(
                            db,
                            user_uid,
                            curr_date_formated(),
                            "plates",
                            "" + num_pratos,
                            "food",
                            "1"
                        );

                        // Aguardar a conclusão da chamada assíncrona
                        var docSnap = await getDoc(docRef);

                        if (docSnap.exists()) {
                            num_pratos++;
                            //   console.log(num_pratos);
                        } else {
                            //   console.log("Parou o loop com " + num_pratos + " pratos");
                            stop = true;
                        }
                    } catch (error) {
                        // console.error("Erro ao recuperar os dados:", error);
                        stop = true;
                    }
                }

                return num_pratos;
            }

            var num_pratos = 0;
            // Chama a função assíncrona para obter o número de pratos
            await getNumberOfPlates().then(function (n) {
                // console.log("Número de pratos: " + n);
                num_pratos = n;
            });
            //   console.log("Número de pratos: " + num_pratos);

            // Itera pelos alimentos
            for (var i = 1; i <= qtd_alimentos; i++) {
                // Obtém o nome do alimento
                var nome_alimento = document.getElementById('filtro_textual_' + i).value;
                // Obtém a quantidade do alimento
                var quantidade_alimento = document.getElementById('slider_alimento_' + i).value;

                // Verifica se o nome do alimento não é vazio
                if (nome_alimento) {
                    // Cria (ou atualiza) o documento para o usuário no Firestore (atual)
                    // console.log("Vai ser inserido o alimento " + nome_alimento + " com quantidade " + quantidade_alimento + " no prato " + num_pratos)
                    setDoc(doc(db, user_uid, curr_date_formated(), "plates", "" + num_pratos, "food", "" + i), {
                        name: nome_alimento,
                        quantity: quantidade_alimento,
                        // hora no formato hh:mm
                        hour: curr_hour_formated()
                    })
                        .then(() => {
                            console.log("Documento atualizado com sucesso!");
                            getDataToTodayPage();
                            fillPlatesList();
                        }
                        )
                        .catch((error) => {
                            // Ocorreu um erro ao gravar no Firestore
                            console.error("Erro ao criar o documento: ", error);
                        }
                        );
                }
            }
        });

        /*
        // Recupera os dados do usuário
        getDoc(docRef)
            .then((docSnap) => {
                // Define os valores dos campos dos dados do usuário
                document.getElementById("m").value = docSnap.data()["weight"];
                document.getElementById("pp").value = docSnap.data()["protein_percent"];
                document.getElementById("pc").value = docSnap.data()["carbs_percent"];
                document.getElementById("pl").value = docSnap.data()["lipids_percent"];
                document.getElementById("tol").value = docSnap.data()["tolerance"];

            })
            .catch((error) => {
                console.error("Erro ao recuperar os dados:", error);
            });
        */

        // Adiciona a função para adicionar mais seletores de alimentos ao botão "mais_alimentos"
        document.getElementById("mais_alimentos").addEventListener("click", add_selector);

        // Adiciona a função para remover seletores de alimentos ao botão "menos_alimentos"
        document.getElementById("menos_alimentos").addEventListener("click", remove_selector);

        // Função para pegar os filhos de um elemento
        function get_children(element) {
            var children = [];
            var child = element.firstChild;
            while (child) {
                if (child.nodeType == 1) {
                    children.push(child);
                }
                child = child.nextSibling;
            }
            return children;
        }

        // Função para adicionar mais seletores de alimentos
        function add_selector() {
            // Cria um novo elemento de seleção de alimentos
            var new_selector = document.createElement("div");
            // Obtém o número de seletores de alimentos já existentes
            var num_selectors = get_children(document.getElementById("alimentos_do_prato")).length;
            var num = num_selectors + 1;
            // Adiciona o id ao novo elemento de seleção de alimentos
            new_selector.id = "seletor_alimentos_" + num;
            new_selector.innerHTML = `
                <!-- Seletor ` + num + ` -->
                <div class="row">
                    <div class="col-md-6">
                        <!-- Dropdown com a lista de alimentos junto do campo de filtro textual -->
                        <input type="search" list="lista_alimentos" id="filtro_textual_` + num + `" 
                        placeholder="Escolha um alimento :)" class="filtro_textual">
                        <datalist id="lista_alimentos"></datalist>
                    </div>
                    <div class="col-md-6">
                        <p id="alimento_` + num + `">
                            <input type="range" id="slider_alimento_` + num + `" value="0" min="0" max="300"
                                oninput="this.nextElementSibling.value = this.value">
                            <input type="text" id="quantidade_alimento_` + num + `" value="0" 
                            oninput="this.previousElementSibling.value = this.value" class="quantidade_alimento">
                            g
                        </p>
                    </div>
                </div>
            `
            // Adiciona o novo elemento de seleção de alimentos ao final da lista de seletores de alimentos
            document.getElementById("alimentos_do_prato").appendChild(new_selector);

            d3.select("#filtro_textual_" + num)
                .on("change",
                    function () {
                        highlight_foods();
                    }
                );
        }

        // Função para remover seletores de alimentos
        function remove_selector() {
            // Obtém o número de seletores de alimentos já existentes
            var num_selectors = get_children(document.getElementById("alimentos_do_prato")).length;
            // Se houver mais de um seletor de alimentos, remove o último
            if (num_selectors > 1) {
                document.getElementById("alimentos_do_prato").removeChild(document.getElementById("seletor_alimentos_" + num_selectors));
            }
        }

        // Seletores de tabs para os chats
        var tabsChats = document.querySelectorAll('.tabs_charts.nav-link');
        tabsChats.forEach(function (tab) {
            tab.addEventListener('click', function (event) {
                event.preventDefault();

                // Obtém o conteúdo alvo (pane) associado à tab
                var target = document.querySelector(this.getAttribute('href'));

                // Remove a classe 'active' de todas as tabs
                var activeTabs = document.querySelectorAll('.tabs_charts.nav-link.active');
                activeTabs.forEach(function (activeTab) {
                    activeTab.classList.remove('active');
                });

                // Remove as classes 'show' e 'active' de todas as panes
                var activePanes = document.querySelectorAll('.tabs_charts.tab-pane.fade.show.active');
                activePanes.forEach(function (activePane) {
                    activePane.classList.remove('show', 'active');
                    activePane.classList.add('not_visible');
                });

                // Adiciona a classe 'active' na tab clicada
                this.classList.add('active');

                // Adiciona as classes 'show' e 'active' na pane correspondente
                target.classList.add('show', 'active');
                target.classList.remove('not_visible');
            });
        });

        // Seletores de tabs para as páginas
        var tabsPages = document.querySelectorAll('.tabs_pages.nav-link');
        tabsPages.forEach(function (tab) {
            tab.addEventListener('click', function (event) {
                event.preventDefault();

                // Obtém o conteúdo alvo (pane) associado à tab
                var target = document.querySelector(this.getAttribute('href'));

                // Remove a classe 'active' de todas as tabs
                var activeTabs = document.querySelectorAll('.tabs_pages.nav-link.active');
                activeTabs.forEach(function (activeTab) {
                    activeTab.classList.remove('active');
                });

                // Remove as classes 'show' e 'active' de todas as panes
                var activePanes = document.querySelectorAll('.tabs_pages.tab-pane.fade.show.active');
                activePanes.forEach(function (activePane) {
                    activePane.classList.remove('show', 'active');
                    activePane.classList.add('not_visible');
                });

                // Adiciona a classe 'active' na tab clicada
                this.classList.add('active');

                // Adiciona as classes 'show' e 'active' na pane correspondente
                target.classList.add('show', 'active');
                target.classList.remove('not_visible');
            });
        });


        // Seletores de tabs para os micro nutrientes
        var tabsPages = document.querySelectorAll('.today_tab.nav-link');
        tabsPages.forEach(function (tab) {
            tab.addEventListener('click', function (event) {
                event.preventDefault();

                // Obtém o conteúdo alvo (pane) associado à tab
                var target = document.querySelector(this.getAttribute('href'));

                // Remove a classe 'active' de todas as tabs
                var activeTabs = document.querySelectorAll('.today_tab.nav-link.active');
                activeTabs.forEach(function (activeTab) {
                    activeTab.classList.remove('active');
                });

                // Remove as classes 'show' e 'active' de todas as panes
                var activePanes = document.querySelectorAll('.today_tab.tab-pane.fade.show.active');
                activePanes.forEach(function (activePane) {
                    activePane.classList.remove('show', 'active');
                    activePane.classList.add('not_visible');
                });

                // Adiciona a classe 'active' na tab clicada
                this.classList.add('active');

                // Adiciona as classes 'show' e 'active' na pane correspondente
                target.classList.add('show', 'active');
                target.classList.remove('not_visible');
            });
        });

        // Preenche a lista de pratos do dia
        // Função assíncrona para recuperar os pratos do dia
        // Função assíncrona para recuperar os pratos do dia
        async function getPlates() {
            var plates = []; // Lista vazia para armazenar os pratos
            var num_pratos = 0;
            var stop = false;

            while (!stop) {

                try {
                    var formated_date = data.toISOString().slice(0, 10);
                    var docRef = doc(db, user_uid, new Date().toISOString().slice(0, 10), "plates", "" + num_pratos, "food", "1");
                    var docSnap = await getDoc(docRef);

                    if (docSnap.exists()) {
                        var plateData = docSnap.data();
                        plates.push(plateData); // Adiciona o prato à lista
                        num_pratos++;
                    } else {
                        stop = true;
                    }
                } catch (error) {
                    console.error("Erro ao recuperar os dados:", error);
                    stop = true;
                }
            }

            return plates; // Retorna a lista de pratos
        }

        // Função para preencher a lista de pratos do dia
        function fillPlatesList(plates) {
            // Chama a função assíncrona para obter todos os pratos
            getAllPlates().then(function (plates) {

                // Exemplo do html gerado
                `
                <div class="plates_container">
                    <div class="row">
                        <div class="col-md-12">
                            <h3>
                                Prato 1 - 07:35
                            </h3>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-2">
                            <p>
                                85g
                            </p>
                        </div>
                        <div class="col-md-10">
                            <p>
                                Arroz integral cozido
                            </p>
                        </div>
                    </div>
                </div>
                `

                function div_title_plate(num_plate, hour) {
                    var div = `
                        <div class="row">
                            <div class="col-md-12">
                                <h3>
                                    Prato `+ (parseInt(num_plate) + 1) + ` - ` + hour + `
                                </h3>
                            </div>
                        </div>`
                    return div;
                }

                function div_food_of_plate(food_name, quantity) {
                    var div = `
                        <div class="row">
                            <div class="col-md-2">
                                <p>
                                    `+ quantity + `g
                                </p>
                            </div>
                            <div class="col-md-10">
                                <p>
                                    `+ food_name + `
                                </p>
                            </div>
                        </div>`
                    return div;
                }



                var html_string = ``;


                // Preenche a lista de pratos com os dados recuperados do firebase
                for (var plateIndex in plates) {
                    // Abre a div do prato
                    html_string += `<div class="plates_container">`;

                    // Obtém o prato atual
                    var plate = plates[plateIndex];

                    // Adiciona o título do prato
                    html_string += div_title_plate(plateIndex, plate.hour);

                    // Adiciona os alimentos do prato
                    for (var foodIndex in plate["food"]) {
                        if (foodIndex !== "hour") {
                            // Obtém o alimento atual
                            var food = plate["food"][foodIndex];
                            // Adiciona o alimento ao prato
                            html_string += div_food_of_plate(food["name"], food["quantity"]);
                        }
                    }

                    // Fecha a div do prato
                    html_string += `</div>`;
                }


                html_string += `</div>`;

                document.getElementById("lista_pratos_do_dia").innerHTML = html_string;

            });
        }

        // Preenche a lista de pratos do dia
        fillPlatesList();

        async function getAllPlates(date = 0) {
            var plates = {}; // Objeto para armazenar os pratos
            var num_pratos = 0;
            var stop_1 = false;
            var stop_2 = false;

            if (!date) {
                date = curr_date_formated()
            }

            while (!stop_1) {
                var num_food = 1;
                stop_1 = true;
                stop_2 = false;

                while (!stop_2) {
                    if (num_food == 2) {
                        stop_1 = false;
                    }

                    try {
                        var docRef = doc(
                            db,
                            user_uid,
                            date,
                            "plates",
                            "" + num_pratos,
                            "food",
                            num_food.toString()
                        );

                        // Aguardar a conclusão da chamada assíncrona
                        var docSnap = await getDoc(docRef);

                        if (docSnap.exists()) {
                            // Obter dados do prato atual
                            var plateData = docSnap.data();
                            var nomeAlimento = plateData["name"];
                            var quantidade = plateData["quantity"];
                            var hora = plateData["hour"];

                            // Adicionar prato ao objeto de pratos
                            if (!plates[num_pratos]) {
                                plates[num_pratos] = {
                                    hour: hora,
                                };
                                plates[num_pratos]["food"] = {};
                            }

                            plates[num_pratos]["food"][num_food.toString()] = {
                                name: nomeAlimento,
                                quantity: quantidade,
                            };

                            num_food++;
                        } else {
                            stop_2 = true;
                        }
                    } catch (error) {
                        console.error("Erro ao recuperar os dados:", error);
                        stop_2 = true;
                    }
                }
                num_pratos++;
            }

            return plates; // Retornar objeto de pratos
        }

        // Função para pegar todos os pratos do mês
        async function getAllPlatesInMonth(year, month) {
            var plates = {}; // Objeto para armazenar os pratos
            var days_in_month = getDaysInMonth(year, month); // Dias no mês

            if (month < 10) {
                month = "0" + month;
            }

            // Itera pelos dias do mês
            for (var day = 1; day <= days_in_month; day++) {
                if (day < 10) {
                    day = "0" + day;
                }

                // Pega o dia atual
                var date = year + "-" + month + "-" + day;

                // Pega os pratos do dia
                var plates_of_day = await getAllPlates(date);

                // Adiciona os pratos do dia ao objeto de pratos
                plates[date] = plates_of_day;
            }

            // Objeto JavaScript
            var objeto = { nome: "João", idade: 25, cidade: "São Paulo" };

            return plates; // Retornar objeto de pratos
        }

        function curr_date_formated() {
            var data = new Date().toLocaleString("pt-BR", { timeZone: "America/Sao_Paulo" });
            var dia = data.slice(0, 2);
            var mes = data.slice(3, 5);
            var ano = data.slice(6, 10);
            return ano + "-" + mes + "-" + dia;

        }

        function curr_hour_formated() {
            var data = new Date().toLocaleString("pt-BR", { timeZone: "America/Sao_Paulo" });
            return data.slice(12, 17);
        }

        // Adiciona um evento a todos os botões da classe nav-link
        var nav_links = document.getElementsByClassName("nav-link");

        // Itera sobre os elementos da coleção nav_links
        for (var i = 0; i < nav_links.length; i++) {
            // Adiciona o evento de clique a cada elemento
            nav_links[i].addEventListener("click", function () {
                // Obtém a div de id #matrix_tooptip
                var matrix_tooltip = document.getElementById("matrix_tooltip");

                if (matrix_tooltip) {
                    // Fecha a div
                    matrix_tooltip.style.visibility = "hidden";

                    // Fecha o pai da div
                    matrix_tooltip.parentElement.style.visibility = "hidden";
                }
            });
        }

        function getDaysInMonth(year, month) {
            // Cria um objeto Date com o primeiro dia do próximo mês
            var date = new Date(year, month, 1); // Mes: 1 = Janeiro, 2 = Fevereiro, ...

            // Subtrai 1 dia para obter o último dia do mês atual
            date.setDate(date.getDate() - 1);

            // Retorna o número de dias no mês
            return date.getDate();
        }

        $(document).ready(function () {
            // Inicialize o Monthpicker
            $("#monthpicker").datepicker({
                format: "mm/yyyy",
                minViewMode: "months",
                autoclose: false,
                altField: "#dateHidden",
                onClose: function (dateText, inst) {
                    var selectedDate = $(this).datepicker("getDate");
                    var selectedMonth = $.datepicker.formatDate("mm", selectedDate);
                    // Outras ações que você deseja realizar quando o valor do monthpicker for alterado
                }
            }).on("changeDate", function (e) {
                var selectedMonth = e.date.toISOString(); // Obtém o mês selecionado (adiciona +1 porque os meses em JavaScript são baseados em zero) 
                var year = e.date.getFullYear(); // Obtém o ano selecionado
                var month = e.date.getMonth() + 1; // Obtém o mês selecionado (adiciona +1 porque os meses em JavaScript são baseados em zero)

                monthpickerFunction(year, month);
                // Outras ações que você deseja realizar quando o valor do monthpicker for alterado
            }).datepicker("show")
        });

        async function getUserInfo(
            date = 0,
            infos = [
                "weight",
                "last_weight",
                "daily_calories",
                "carbs_percent",
                "lipids_percent",
                "protein_percent",
                "tolerance",
                "num_daily_plates"],
        ) {
            if (date == 0) {
                date = curr_date_formated();
            }
            var data = {};

            try {
                var docRef = doc(db, user_uid, date, "user_info", "info");

                // Aguardar a conclusão da chamada assíncrona
                var docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    // Obter dados do prato atual
                    var user_data = docSnap.data();
                    for (var i = 0; i < infos.length; i++) {
                        data[infos[i]] = user_data[infos[i]];
                    }
                }
            } catch (error) {
                console.error("Erro ao recuperar os dados:", error);
            }

            return data;
        }

        async function getUserInfoOfMonth(
            year,
            month,
            infos = [
                "weight",
                "last_weight",
                "daily_calories",
                "carbs_percent",
                "lipids_percent",
                "protein_percent",
                "tolerance",
                "num_daily_plates"
            ]
        ) {
            var user_uid = localStorage.getItem("user_uid");
            var days_in_month = getDaysInMonth(year, month); // Dias no mês
            var data = {};

            if (month < 10) {
                month = "0" + month;
            }

            // Itera pelos dias do mês
            for (var day = 1; day <= days_in_month; day++) {
                if (day < 10) {
                    day = "0" + day;
                }

                // Pega o dia atual
                var date = year + "-" + month + "-" + day;



                // Pega o peso do dia
                var data_of_day = await getUserInfo(
                    date,
                    infos,
                );

                // Adiciona o peso do dia ao objeto de pesos
                data[date] = data_of_day;
            }

            return data;
        }

        async function getFoodNutritionalInfo(food_name, quantity = 100) {
            // Todas as colunas
            // ["Nome", "Saturados (g)", "Monoinsaturados (g)", "Poliinsaturados (g)", "Manganês (mg)", "Fósforo (mg)", "Ferro (mg)", "Sódio (mg)", "Cobre (mg)", "Zinco (mg)", "Retinol(µg)", "Tiamina (mg)", "Riboflavina (mg)", "Piridoxina (mg)", "Niacina (mg)", "Vitamina C (mg)", "id", "Umidade (%)", "Energia (kcal)", "Energia (kJ)", "Proteína (g)", "Lipídeos (g)", "Colesterol (mg)", "Carboidrato (g)", "Fibra Alimentar (g)", "Cinzas (g)", "Cálcio (mg)", "Magnésio (mg)"]
            // Colunas que serão usadas
            var columns = ["Saturados (g)", "Monoinsaturados (g)", "Poliinsaturados (g)", "Manganês (mg)", "Fósforo (mg)", "Ferro (mg)", "Sódio (mg)", "Cobre (mg)", "Zinco (mg)", "Retinol(µg)", "Tiamina (mg)", "Riboflavina (mg)", "Piridoxina (mg)", "Niacina (mg)", "Vitamina C (mg)", "Umidade (%)", "Energia (kcal)", "Energia (kJ)", "Proteína (g)", "Lipídeos (g)", "Colesterol (mg)", "Carboidrato (g)", "Fibra Alimentar (g)", "Cinzas (g)", "Cálcio (mg)", "Magnésio (mg)"]

            // Transforma a quantidade em um inteiro
            quantity = parseInt(quantity);

            // Pega os dados dos alimentos
            /*
            var food_info = {
                ...data.find(function (item) {
                    return item.Nome === food_name;
                })
            };
            */
            var food_info = { ...data[food_indexes[food_name]] };

            // Corrige os valores de acordo com a quantidade
            for (var column_index in columns) {
                var column = columns[column_index];
                food_info[column] = food_info[column] * quantity / 100;
            }

            return food_info;
        }

        async function getNutritionalInfoOfPlate(plate) {
            // Todas as colunas
            // ["Nome", "Saturados (g)", "Monoinsaturados (g)", "Poliinsaturados (g)", "Manganês (mg)", "Fósforo (mg)", "Ferro (mg)", "Sódio (mg)", "Cobre (mg)", "Zinco (mg)", "Retinol(µg)", "Tiamina (mg)", "Riboflavina (mg)", "Piridoxina (mg)", "Niacina (mg)", "Vitamina C (mg)", "id", "Umidade (%)", "Energia (kcal)", "Energia (kJ)", "Proteína (g)", "Lipídeos (g)", "Colesterol (mg)", "Carboidrato (g)", "Fibra Alimentar (g)", "Cinzas (g)", "Cálcio (mg)", "Magnésio (mg)"]
            // Colunas que serão usadas
            var columns = ["Saturados (g)", "Monoinsaturados (g)", "Poliinsaturados (g)", "Manganês (mg)", "Fósforo (mg)", "Ferro (mg)", "Sódio (mg)", "Cobre (mg)", "Zinco (mg)", "Retinol(µg)", "Tiamina (mg)", "Riboflavina (mg)", "Piridoxina (mg)", "Niacina (mg)", "Vitamina C (mg)", "Umidade (%)", "Energia (kcal)", "Energia (kJ)", "Proteína (g)", "Lipídeos (g)", "Colesterol (mg)", "Carboidrato (g)", "Fibra Alimentar (g)", "Cinzas (g)", "Cálcio (mg)", "Magnésio (mg)"]

            // Variável que armazenará as informações nutricionais do prato
            var plate_nutritional_info = {};

            // Itera pelos alimentos do prato
            for (var food_index in plate) {
                // Alimento atual
                var food = plate[food_index];

                // Pega as informações nutricionais do alimento
                var food_nutritional_info = await getFoodNutritionalInfo(food["name"], food["quantity"]);

                // Adiciona as informações nutricionais do alimento ao prato
                for (var column_index in columns) {
                    var column = columns[column_index];
                    if (plate_nutritional_info[column] == undefined) {
                        plate_nutritional_info[column] = 0;
                    }
                    plate_nutritional_info[column] += food_nutritional_info[column];
                }
            }

            return plate_nutritional_info;
        }

        async function getNutritionalInfoOfPlates(plates) {
            // Todas as colunas
            // ["Nome", "Saturados (g)", "Monoinsaturados (g)", "Poliinsaturados (g)", "Manganês (mg)", "Fósforo (mg)", "Ferro (mg)", "Sódio (mg)", "Cobre (mg)", "Zinco (mg)", "Retinol(µg)", "Tiamina (mg)", "Riboflavina (mg)", "Piridoxina (mg)", "Niacina (mg)", "Vitamina C (mg)", "id", "Umidade (%)", "Energia (kcal)", "Energia (kJ)", "Proteína (g)", "Lipídeos (g)", "Colesterol (mg)", "Carboidrato (g)", "Fibra Alimentar (g)", "Cinzas (g)", "Cálcio (mg)", "Magnésio (mg)"]
            // Colunas que serão usadas
            var columns = ["Saturados (g)", "Monoinsaturados (g)", "Poliinsaturados (g)", "Manganês (mg)", "Fósforo (mg)", "Ferro (mg)", "Sódio (mg)", "Cobre (mg)", "Zinco (mg)", "Retinol(µg)", "Tiamina (mg)", "Riboflavina (mg)", "Piridoxina (mg)", "Niacina (mg)", "Vitamina C (mg)", "Umidade (%)", "Energia (kcal)", "Energia (kJ)", "Proteína (g)", "Lipídeos (g)", "Colesterol (mg)", "Carboidrato (g)", "Fibra Alimentar (g)", "Cinzas (g)", "Cálcio (mg)", "Magnésio (mg)"]

            var nutritional_info = {};
            // Itera pelos pratos
            for (var plate_index in plates) {
                var plate = plates[plate_index]; // Prato atual

                // Pega as informações nutricionais do prato
                var plate_nutritional_info = await getNutritionalInfoOfPlate(plate["food"]);

                // Adiciona as informações nutricionais do prato
                for (var column_index in columns) {
                    var column = columns[column_index];
                    if (nutritional_info[column] == undefined) {
                        nutritional_info[column] = 0;
                    }
                    nutritional_info[column] += plate_nutritional_info[column];
                }
            }
            return nutritional_info;
        }

        async function getNutritionalInfoOfPlatesInMonth(plates_of_month) {
            // Itera pelos dias
            for (var day_index in plates_of_month) {
                var day = plates_of_month[day_index]; // Dia atual
                if (Object.keys(day).length == 0) { // Se o dia não tiver pratos
                    continue;
                }

                var plates_nutritional_info = await getNutritionalInfoOfPlates(day);

                // Adiciona as informações nutricionais dos pratos
                plates_of_month[day_index] = plates_nutritional_info;
            }
            return plates_of_month;
        }

        async function getWeightOfMonth(year, month) {
            var weight2 = await getUserInfoOfMonth(year, month, ["weight", "last_weight"]);
            var weight = { ...weight2 };

            // último dia do mês
            var last_day = new Date(year, month, 0).getDate();
            // Se estivermos no mês atual, o último dia é o dia atual
            if (year == new Date().getFullYear() && month == new Date().getMonth() + 1) {
                last_day = new Date().getDate();
            }

            // Corrige o mês para o formato MM
            if (month < 10) {
                month = "0" + month;
            }

            // Itera pelos dias na ordem crescente para preencher os dias vazios
            // Último peso registrado
            for (var day = 2; day <= last_day; day++) {
                // Dia anterior
                var prev_day = day - 1;
                if (prev_day < 10) {
                    prev_day = "0" + prev_day;
                }
                // Pega o peso do dia anterior
                prev_day = year + "-" + month + "-" + prev_day;
                // Se o dia anterior não tiver peso registrado
                if (Object.keys(weight[prev_day]).length == 0) {
                    continue;
                }

                // Corrige o dia para o formato DD
                if (day < 10) {
                    day = "0" + day;
                }
                // Pega o peso do dia atual
                var curr_day = year + "-" + month + "-" + day;

                // Se o dia não tiver peso registrado
                if (Object.keys(weight[curr_day]).length == 0) {
                    // Preenche o dia com o último peso registrado
                    weight[curr_day] = {
                        "weight": weight[prev_day]["weight"],
                        "last_weight": weight[prev_day]["weight"]
                    }
                }
            }

            // Itera pelos dias na ordem decrescente para preencher os dias vazios
            for (var day = last_day - 1; day >= 1; day--) {
                // Dia posterior
                var next_day = day + 1;
                if (next_day < 10) {
                    next_day = "0" + next_day;
                }
                // Pega o peso do dia posterior
                next_day = year + "-" + month + "-" + next_day;
                // Se o dia posterior não tiver peso registrado
                if (Object.keys(weight[next_day]).length == 0) {
                    continue;
                }

                // Corrige o dia para o formato DD
                if (day < 10) {
                    day = "0" + day;
                }
                // Pega o peso do dia atual
                var curr_day = year + "-" + month + "-" + day;

                // Se o dia não tiver peso registrado
                if (Object.keys(weight[curr_day]).length == 0 && weight[next_day]["last_weight"] != -1) {
                    // Preenche o dia com o último peso registrado
                    weight[curr_day] = {
                        "weight": weight[next_day]["last_weight"],
                        "last_weight": weight[next_day]["last_weight"]
                    }
                }
            }

            // Se nenhum dia do mês tiver peso registrado
            async function hasWeight(weight) {
                var has_weight = false;
                for (var i in weight) {
                    if (Object.keys(weight[i]).length !== 0) {
                        has_weight = true;
                        break;
                    }
                }
                return has_weight;
            }

            var has_weight = await hasWeight(weight);
            if (!has_weight) {
                // Verifica se a data atual é maior que o ultimo dia do mês
                var today = new Date();
                // Itera pelos dias a partir do dia 1 do mês seguinte até encontrar um dia com peso registrado
                // ou até chegar no dia atual
                var next_year = parseInt(year);
                var next_month = 1 + (parseInt(month) % 12);
                if (next_month == 1) {
                    year++;
                }
                while (
                    next_year < today.getFullYear() ||
                    (next_year == today.getFullYear() && next_month < today.getMonth() + 1) ||
                    (next_year == today.getFullYear() && next_month == today.getMonth() + 1 && last_day < today.getDate())
                ) {
                    if (next_month < 10) {
                        next_month = "0" + next_month;
                    }
                    var next_last_day = new Date(year, month, 0).getDate();
                    for (var next_day = 1; next_day <= next_last_day; next_day++) {
                        // Corrige o dia para o formato DD
                        if (next_day < 10) {
                            next_day = "0" + next_day;
                        }
                        // Pega o peso do dia posterior
                        next_day = next_year + "-" + next_month + "-" + next_day;
                        var next_weight = await getUserInfo(next_day, ["last_weight"]);
                        // Se o dia posterior não tiver peso registrado
                        if (Object.keys(next_weight).length == 0) {
                            // Se encontrar um dia com peso registrado
                        } else {
                            // Preenche todos os dias do mês com o peso do dia encontrado
                            for (var index in weight) {
                                weight[index] = {
                                    "weight": next_weight["last_weight"],
                                    "last_weight": next_weight["last_weight"]
                                }
                            }
                            return weight;
                        }
                        next_day = parseInt(next_day.slice(8, 10));
                    }

                    // Próximo mês
                    next_month = 1 + (parseInt(next_month) % 12);
                    if (next_month == 1) {
                        next_year++;
                    }
                }

                // Se não encontrar nenhum dia com peso registrado
                // Pega as informações atuais do usuário
                var user_info = await getUserCurrentInfo(["weight"]);
                // Preenche todos os dias do mês com o peso atual do usuário
                for (var index in weight) {
                    weight[index] = {
                        "weight": user_info["weight"],
                        "last_weight": user_info["weight"]
                    }
                }
            }

            return weight;
        }

        // Obtém o ano e o mês atual
        var curr_year = new Date().getFullYear();
        var curr_month = new Date().getMonth() + 1;
        // Preenche o gráfico de peso com os dados do mês atual
        await monthpickerFunction(curr_year, curr_month)

        async function getUserCurrentInfo(
            infos = [
                "weight",
                "last_weight",
                "daily_calories",
                "carbs_percent",
                "lipids_percent",
                "protein_percent",
                "tolerance",
                "num_daily_plates"
            ]
        ) {
            // Variável para os dados do usuário
            var user_info = {};

            // Recupera os dados do usuário
            const docRef = doc(db, "user_info", user_uid);
            await getDoc(docRef)
                .then((docSnap) => {
                    // Recupera os dados do documento (testes)
                    if (docSnap.exists()) {
                        var data = docSnap.data();
                        for (var i = 0; i < infos.length; i++) {
                            user_info[infos[i]] = data[infos[i]];
                        }
                    } else {
                        console.log("No such document!");
                    }
                })
                .catch((error) => {
                    console.error("Erro ao recuperar os dados:", error);
                });

            // Retorna os dados do usuário
            return user_info;
        }

        // Função do monthpicker
        async function monthpickerFunction(year, month) {
            const plates = await getAllPlatesInMonth(year, month);
            const nutritional_info_of_month = await getNutritionalInfoOfPlatesInMonth(plates);
            const weight = await getWeightOfMonth(year, month);

            var data_to_linechart = {};
            // Itera pelos dias
            for (var day_index in nutritional_info_of_month) {
                var curr_nutritional_info = nutritional_info_of_month[day_index]; // Dia atual
                var curr_weight = weight[day_index]; // Dia atual

                // Adiciona a data
                data_to_linechart[day_index] = {
                    "Data": day_index
                };

                // Se o dia não tiver pratos, preenche os dados nutricionais com -1
                if (Object.keys(curr_nutritional_info).length == 0) {
                    for (var colum_index in nutritional_columns) {
                        const colum = nutritional_columns[colum_index];
                        data_to_linechart[day_index][colum] = -1;
                    }

                    data_to_linechart[day_index]
                    // Se o dia tiver pratos, adiciona a informação nutricional
                } else {
                    for (var colum_index in nutritional_columns) {
                        const colum = nutritional_columns[colum_index];
                        data_to_linechart[day_index][colum] = curr_nutritional_info[colum];
                    }
                }

                if (Object.keys(curr_weight).length == 0) { // Se o dia não tiver registro de peso
                    data_to_linechart[day_index]["Peso"] = -1;
                } else {
                    // Adiciona o peso do dia
                    data_to_linechart[day_index]["Peso"] = curr_weight["weight"]
                }

            }

            // Altera os índeces para 0, 1, 2, ...
            data_to_linechart = Object.values(data_to_linechart);

            // Pega o elemento para os dados do linechart
            var linechart_data = document.getElementById("micronutrientes_data");

            // Insere os dados no elemento como JSON (substitui o conteúdo anterior)
            linechart_data.value = JSON.stringify(data_to_linechart);

            // Dispara o evento change para o elemento
            var event = new Event("change");
            linechart_data.dispatchEvent(event);

            return data_to_linechart;
        }


        // Função para tra

        // Lê os dados do csv archive/macronutrientes.csv
        async function readCSV(file) {
            // Lê o arquivo csv
            var csv = await fetch(file);

            // Converte o arquivo csv para texto
            var text = await csv.text();

            const lines = text.split('\n');
            const headers = lines[0].split(',');

            const result = [];

            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].split(',');
                const obj = {};

                for (let j = 0; j < headers.length; j++) {
                    obj[headers[j]] = line[j];
                }

                result.push(obj);
            }

            return result;
        }


        async function getDataToTodayPage() {
            var date = curr_date_formated();
            var plates_of_day = await getAllPlates(date);
            var plates_nutritional_info = await getNutritionalInfoOfPlates(plates_of_day);

            if (Object.keys(plates_nutritional_info).length == 0) {
                for (let index in nutritional_columns) {
                    plates_nutritional_info[nutritional_columns[index]] = 0;
                }
            }

            var minerals_data = [{
                "Cobre (mg)": plates_nutritional_info["Cobre (mg)"],
                "Ferro (mg)": plates_nutritional_info["Ferro (mg)"],
                "Fósforo (mg)": plates_nutritional_info["Fósforo (mg)"],
                "Manganês (mg)": plates_nutritional_info["Manganês (mg)"],
                "Sódio (mg)": plates_nutritional_info["Sódio (mg)"],
                "Zinco (mg)": plates_nutritional_info["Zinco (mg)"]
            }]

            var vitamins_data = [{
                "Tiamina (mg)": plates_nutritional_info["Tiamina (mg)"],
                "Riboflavina (mg)": plates_nutritional_info["Riboflavina (mg)"],
                "Piridoxina (mg)": plates_nutritional_info["Piridoxina (mg)"],
                "Niacina (mg)": plates_nutritional_info["Niacina (mg)"],
                "Vitamina C (mg)": plates_nutritional_info["Vitamina C (mg)"],
                "Retinol(µg)": plates_nutritional_info["Retinol(µg)"],
            }]

            var fat_data = [{
                'Saturados (g)': plates_nutritional_info['Saturados (g)'],
                "Monoinsaturados (g)": plates_nutritional_info["Monoinsaturados (g)"],
                "Poliinsaturados (g)": plates_nutritional_info["Poliinsaturados (g)"],
            }]

            // Converte os dados para JSON
            minerals_data = JSON.stringify(minerals_data);
            vitamins_data = JSON.stringify(vitamins_data);
            fat_data = JSON.stringify(fat_data);

            // Pega os elementos para os dados dos gráficos
            var minerals_data_element = document.getElementById("minerals_data");
            var vitamins_data_element = document.getElementById("vitamins_data");
            var fat_data_element = document.getElementById("fat_data");

            // Insere os dados nos elementos como JSON (substitui o conteúdo anterior)
            minerals_data_element.value = minerals_data;
            vitamins_data_element.value = vitamins_data;
            fat_data_element.value = fat_data;

            // Dispara o evento change para os elementos
            var event = new Event("change");
            minerals_data_element.dispatchEvent(event);
            vitamins_data_element.dispatchEvent(event);
            fat_data_element.dispatchEvent(event);
        }
        getDataToTodayPage();

    </script>

    <!-- Importa o script feito de conexão com o firebase (módulo) -->
    <script src="conect_firebase.js" type="module"></script>
</head>

<!-- Header da página -->
<header>

    <!-- Título da página -->
    <div class="row justify-content-center principal_container">
        <div class="col-md-1">
        </div>
        <div class="col-md-1">
        </div>
        <div class="col-md-1">
            <!-- Logo da página -->
            <img src="img/logo_sem_fundo.png" alt="Logo" class="logo" id="logo">
        </div>
        <div class="col-md-6 justify-content-center align-items-center" style="display:flex;">
            <div class="row justify-content-center align-items-center">
                <!-- Título -->
                <h1 style="margin-bottom: 0px;">NUTRIÇÃO EM UM OLHAR</h1>
            </div>
        </div>
        <div class="col-md-1 center_col">
            <div class="row justify-content-center align-items-center">
                <button type="button" class="btn btn-primary header_button" onclick="window.location.href='app.html'">
                    App
                </button>
            </div>
        </div>
        <div class="col-md-1 center_col">
            <div class="row justify-content-center align-items-center">
                <button type="button" class="btn btn-primary header_button"
                    onclick="window.location.href='tutorial.html'">
                    Tutorial
                </button>
            </div>
        </div>
        <div class="col-md-1 center_col">
            <div class="row justify-content-center align-items-center">
                <button type="button" class="btn btn-primary header_button" onclick="window.location.href='about.html'">
                    Sobre
                </button>
            </div>
        </div>
    </div>
</header>

<body>
    <!-- Dados em json -->
    <textarea id="micronutrientes_data" class="not_visible"></textarea>
    <textarea id="vitamins_data" class="not_visible"></textarea>
    <textarea id="fat_data" class="not_visible"></textarea>
    <textarea id="minerals_data" class="not_visible"></textarea>

    <!-- Tabs das páginas do app principal -->
    <div class="row">
        <div class="col-md-12 ">
            <div class="principal_container">
                <ul class="nav nav-pills">
                    <li class="nav-item">
                        <a class="tabs_pages nav-link" href="#content_dados_do_usuario" id="tab_dados_do_usuario"
                            type="button">Dados</a>
                    </li>
                    <li class="nav-item">
                        <a class="tabs_pages nav-link active" href="#content_selecao_prato" id="tab_selecao_prato"
                            type="button">Prato</a>
                    </li>
                    <li class="nav-item">
                        <a class="tabs_pages nav-link" href="#content_peso" id="tab_peso" type="button">Peso</a>
                    </li>
                    <li class="nav-item">
                        <a class="tabs_pages nav-link" href="#content_pratos_do_dia" id="tab_pratos_do_dia"
                            type="button">Hoje</a>
                    </li>
                </ul>

            </div>

        </div>
    </div>
    <!-- Conteúdo das tabs princiapis do app -->
    <div class="tab-content">
        <div class="tabs_pages tab-pane fade show active" id="content_selecao_prato" role="tabpanel"
            aria-labelledby="tab_selecao_prato">
            <!-- Aba de seleção do prato -->

            <!-- Área para inserir informações do usuário -->
            <div class="not_visible">
                <div class="principal_container">
                    <h3>Informações do usuário</h3>
                    <div id="observablehq-inserts_cell-db1bfa4f"></div>
                </div>
            </div>


            <!-- Parte só últil no backend -->
            <div id="observablehq-insert_atualize_barchart_cell-db1bfa4f" class="not_visible"></div>

            <!-- Seletor dos alimentos e sliders -->
            <div id="seletor_e_sliders" class="not_visible">
                <!-- Seletor dos alimentos -->
                <div id="observablehq-list_food_cell-db1bfa4f"></div>

                <!-- Sliders para os pesos dos alimentos -->
                <div id="observablehq-sliders_quantity_cell-db1bfa4f"></div>
            </div>


            <div class="row ">
                <!-- Seletores dos alimentos -->
                <div class="col-md-6 fix_height">
                    <div class="principal_container fix_thin_width">
                        <div class="row">
                            <div class="col-md-12">
                                <h3>Monte sua refeição:</h3>
                            </div>
                            <div class="col-md-12">
                                <div class="row justify-content-center">
                                    <div class="col-md-8">
                                        <button class="btn btn-success" type="button" id="confirmar_prato">Salvar
                                            Prato</button>
                                    </div>
                                    <div class="col-md-2">
                                        <button class="btn btn-primary" type="button" id="mais_alimentos">+</button>
                                    </div>
                                    <div class="col-md-2">
                                        <button class="btn btn-primary" type="button" id="menos_alimentos">-</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Seletor 1 -->
                        <div id="alimentos_do_prato">
                            <!-- Seletor 1 -->
                            <div class="row">
                                <div class="col-md-6">
                                    <!-- Dropdown com a lista de alimentos junto do campo de filtro textual -->
                                    <input type="search" list="lista_alimentos" id="filtro_textual_1"
                                        placeholder="Escolha um alimento :)" class="filtro_textual">
                                    <datalist id="lista_alimentos"></datalist>
                                </div>
                                <div class="col-md-6">
                                    <p id="alimento_1">
                                        <input type="range" id="slider_alimento_1" value="0" min="0" max="300"
                                            oninput="this.nextElementSibling.value = this.value">
                                        <input type="text" id="quantidade_alimento_1" value="0"
                                            oninput="this.previousElementSibling.value = this.value"
                                            class="quantidade_alimento">
                                        g
                                    </p>
                                </div>
                            </div>
                        </div>


                        <!-- Valor energético do prato -->
                        <div id="observablehq-valor_energetico-db1bfa4f"></div>

                        <br>
                        <br>
                        <br>

                        <!-- Gráfico de pizza -->
                        <div class="fix_thin_width">
                            <div class="row justify-content-center">
                                <div id="div_pie_chart"></div>
                            </div>
                        </div>


                    </div>


                </div>
                <!-- Gráficos de filtro e de macronutriente -->
                <div class="col-md-6 fix_height">

                    <!-- Tabs dos gráfico -->
                    <div class="principal_container fix_thin_width">
                        <h3>Filtro e Macronutrientes do Prato</h3>
                        <div class="">
                            <ul class="nav nav-tabs">
                                <li class="nav-item">
                                    <a class="tabs_charts nav-link active" href="#content_violin" id="tab_violin"
                                        data-bs-toggle="tab">Filtrar alimentos</a>
                                </li>
                                <li class="nav-item">
                                    <a class="tabs_charts nav-link" href="#content_bar" id="tab_bar"
                                        data-bs-toggle="tab">Distribuição dos Macronutrientes</a>
                                </li>
                            </ul>
                        </div>
                        <!-- Gráficos -->
                        <div id="charts" class="">
                            <div class="tabs_charts tab-pane fade show active" id="content_violin" role="tabpanel"
                                aria-labelledby="tab_violin">
                                <div id="observablehq-violinplot_cell-db1bfa4f"></div>
                            </div>
                            <div class="tabs_charts tab-pane fade not_visible fix_thin_width" id="content_bar"
                                role="tabpanel" aria-labelledby="tab_bar">
                                <!-- Gráfico de barras -->
                                <div id="observablehq-bar_chart_cell-db1bfa4f"></div>
                            </div>
                        </div>
                    </div>


                </div>
            </div>

        </div>

        <!-- Aba de objetivos -->
        <div class="tabs_pages tab-pane fade not_visible" id="content_dados_do_usuario" role="tabpanel"
            aria-labelledby="tab_dados_do_usuario">
            <!-- Aba de objetivos -->
            <!-- Formulário de Inserção de dados -->
            <form>
                <div class="row justify-content-center">
                    <div class="col-md-4 principal_container">
                        <div class="form-group">
                            <label for="weight">Peso (Kg)</label>
                            <input type="number" class="form-control" id="weight" placeholder="70.00">
                        </div>
                        <div class="form-group not_visible">
                            <label for="last_weight">Último Peso (Kg)</label>
                            <input type="number" class="form-control" id="last_weight" placeholder="-1">
                        </div>
                        <div class="form-group">
                            <label for="daily_calories">Calorias Diárias (Kcal)</label>
                            <input type="number" class="form-control" id="daily_calories" placeholder="2000">
                        </div>
                        <div class="form-group">
                            <label for="carbs_percent">Percentual de Carboidratos (%)</label>
                            <input type="number" class="form-control" id="carbs_percent" placeholder="50">
                        </div>
                        <div class="form-group">
                            <label for="lipids_percent">Percentual de Lipídios (%)</label>
                            <input type="number" class="form-control" id="lipids_percent" placeholder="25">
                        </div>
                        <div class="form-group">
                            <label for="protein_percent">Percentual de Proteínas (%)</label>
                            <input type="number" class="form-control" id="protein_percent" placeholder="25">
                        </div>
                        <div class="form-group">
                            <label for="tolerance">Tolerância (%)</label>
                            <input type="number" class="form-control" id="tolerance" placeholder="10">
                        </div>
                        <div class="form-group">
                            <label for="num_daily_plates">Número de refeições por dia</label>
                            <input type="number" class="form-control" id="num_daily_plates" placeholder="4">
                        </div>
                        <div class="row">
                            <div class="col text-center">
                                <button class="btn btn-primary" type="button" id="confirmar">Confirmar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>

        </div>


        <!-- Aba de Peso do usuário -->
        <div class="tabs_pages tab-pane fade not_visible" id="content_peso" role="tabpanel" aria-labelledby="tab_peso">
            <!-- Aba de Peso do usuário -->
            <div class="row">
                <!-- Seletor da data -->
                <!-- <div class="col-md-12 ">

                    <!-/- Seletor da data -/->
                <div class="row  principal_container align-items-center">

                </div>
            </div> -->
            <!-- Gráfico de peso -->
            <div class="col-md-12">
                <!-- Gráfico de peso -->
                <div class="row principal_container">
                    <div class="col-md-12">
                        <h3>
                            Evolução do mês
                        </h3>
                    </div>

                    <!-- Seletor da data -->
                    <div class="col-md-auto align-items-center">
                        <h4 class="">
                            Selecione a data:
                        </h4>
                    </div>
                    <div class="col-md-3 ">
                        <div class="row align-items-center">

                            <!-- Adicione os scripts do Bootstrap e do jQuery -->
                            <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
                            <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> -->



                            <!-- Adicione o CSS do Monthpicker -->
                            <link rel="stylesheet"
                                href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">

                            <!-- Adicione o script do Monthpicker -->
                            <script
                                src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>

                            <!-- <script>
                                $(document).ready(function () {
                                    // Inicialize o Monthpicker
                                    $("#monthpicker").datepicker({
                                        format: "mm/yyyy",
                                        minViewMode: "months",
                                        autoclose: false,
                                        altField: "#dateHidden",
                                        onClose: function(dateText, inst) {
                                            var selectedDate = $(this).datepicker("getDate");
                                            var selectedMonth = $.datepicker.formatDate("mm", selectedDate);
                                            // Outras ações que você deseja realizar quando o valor do monthpicker for alterado
                                        }
                                    }).on("changeDate", function (e) {
                                        var selectedMonth = e.date.toISOString(); // Obtém o mês selecionado (adiciona +1 porque os meses em JavaScript são baseados em zero) 
                                        var year = e.date.getFullYear(); // Obtém o ano selecionado
                                        var month = e.date.getMonth() + 1; // Obtém o mês selecionado (adiciona +1 porque os meses em JavaScript são baseados em zero)
                                        
                                        monthpickerFunction(year, month);
                                        // Outras ações que você deseja realizar quando o valor do monthpicker for alterado
                                    }).datepicker("show")
                                });
                            </script> -->
                            <div class="input-group">
                                <input type="text" id="monthpicker" class="form-control" placeholder="06/2023">
                                <div class="input-group-append">
                                    <span class="input-group-text"><i class="bi bi-calendar3"></i></span>
                                </div>
                            </div>
                            <style>
                                .datepicker.datepicker-dropdown.dropdown-menu.datepicker-orient-left.datepicker-orient-top {
                                    left: 470px !important;
                                    top: 625px !important;
                                }
                            </style>

                        </div>
                    </div>



                    <div class="col-md-12">
                        <div class="row justify-content-center">
                            <!-- CSS do gráfico -->
                            <div id="observablehq-css_grafico_de_peso-db1bfa4f"></div>
                            <!-- Gráfico -->
                            <div id="observablehq-chart_peso-db1bfa4f" class="not_visible"></div>
                            <div id="linechart_legend"></div>
                            <div id="linechart_weight"></div>
                            <div id="linechart_carb"></div>
                            <div id="linechart_protein"></div>
                            <div id="linechart_lipid"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Aba de Refeições do dia -->
    <div class="tabs_pages tab-pane fade not_visible" id="content_pratos_do_dia" role="tabpanel"
        aria-labelledby="tab_pratos_do_dia">
        <div class="row">
            <div class="col-md-6 fix_height">
                <div class="principal_container fix_thin_width">
                    <div class="row">
                        <div class="col-md-12">
                            <h3>Refeições de hoje</h3>
                        </div>
                    </div>
                    <div class="lista_pratos_do_dia" id="lista_pratos_do_dia">
                        <!-- Lista de pratos do dia (preenchida por javascript) -->

                        <!-- Teste preenchido a mão -->
                        <!-- <div class="plates_container">
                                <div class="row">
                                    <div class="col-md-12">
                                        <h3>
                                            Prato 1 - 07:35
                                        </h3>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-2">
                                        <p>
                                            85g
                                        </p>
                                    </div>
                                    <div class="col-md-10">
                                        <p>
                                            Arroz integral cozido
                                        </p>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-2">
                                        <p>
                                            120g
                                        </p>
                                    </div>
                                    <div class="col-md-10">
                                        <p>
                                            Feijoada
                                        </p>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-2">
                                        <p>
                                            100g
                                        </p>
                                    </div>
                                    <div class="col-md-10">
                                        <p>
                                            Frango filé à milanesa
                                        </p>
                                    </div>
                                </div>
                            </div> -->

                    </div>
                </div>
            </div>
            <!-- Aba dos gráficos dos micronutrientes -->
            <div class="col-md-6 fix_height">
                <div class="principal_container fix_thin_width">
                    <h3>Micronutrientes</h3>
                    <!-- Nav-items para gorduras, minerais e vitaminas -->
                    <ul class="nav nav-tabs today_tab" id="today_tab" role="tablist">
                        <li class="nav-item today_tab" role="presentation" id="tab_gorduras">
                            <a class="nav-link active today_tab" id="gorduras-tab" data-toggle="tab"
                                href="#content_gorduras" role="tab" aria-controls="content_gorduras"
                                aria-selected="true">Gorduras</a>
                        </li>
                        <li class="nav-item today_tab" role="presentation" id="tab_minerais">
                            <a class="nav-link today_tab" id="minerais-tab" data-toggle="tab" href="#content_minerais"
                                role="tab" aria-controls="content_minerais" aria-selected="false">Minerais</a>
                        </li>
                        <li class="nav-item today_tab" role="presentation" id="tab_vitaminas">
                            <a class="nav-link today_tab" id="vitaminas-tab" data-toggle="tab" href="#content_vitaminas"
                                role="tab" aria-controls="content_vitaminas" aria-selected="false">Vitaminas</a>
                        </li>
                    </ul>
                    <!-- Conteúdo das tabs das gorduras, minerais e vitaminas -->
                    <div>
                        <div class="tab-content" id="myTabContent">
                            <!-- Conteúdo da tab de gorduras -->
                            <div class="tab-pane fade show active today_tab" id="content_gorduras" role="tabpanel"
                                aria-labelledby="gorduras-tab">
                                <!-- <div id="observablehq-lipids_cell-db1bfa4f"></div> -->
                                <div id="fat_graph_div"></div>
                            </div>
                            <!-- Conteúdo da tab de minerais -->
                            <div class="tab-pane fade not_visible today_tab" id="content_minerais" role="tabpanel"
                                aria-labelledby="minerais-tab">
                                <!-- <div id="observablehq-minerals_cell-db1bfa4f"></div> -->
                                <div id="minerals_graph_div"></div>
                            </div>
                            <!-- Conteúdo da tab de vitaminas -->
                            <div class="tab-pane fade not_visible today_tab" id="content_vitaminas" role="tabpanel"
                                aria-labelledby="minerais-tab">
                                <!-- <div id="observablehq-vitamins_cell-db1bfa4f"></div> -->
                                <div id="vitamins_graph_div"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <!-- Parte só últil no backend -->
    <div class="not_visible">
        <div id="observablehq-init_bar_chart_cell-db1bfa4f"></div>
        <div id="observablehq-outputs_alimentos-db1bfa4f"></div>
        <div id="observablehq-filter_food_to_bar_chart-db1bfa4f"></div>
        <div id="observablehq-alimentos_selecionados-db1bfa4f"></div>
        <div id="observablehq-filtro_textual-db1bfa4f"></div>
        <div id="observablehq-num_alimento-db1bfa4f"></div>
        <div id="observablehq-botao_confirmar-db1bfa4f"></div>
        <div id="observablehq-function_to_sliders_of_quantity_of_food_cell-db1bfa4f"></div>
        <div id="observablehq-function_to_buttons_of_plus_and_less_selectors-db1bfa4f"></div>
        <div id="observablehq-function_confirm_buttom-db1bfa4f"></div>
        <div id="observablehq-update_dropdown-db1bfa4f"></div>
        <div id="observablehq-update_dropdown_cell-db1bfa4f"></div>
        <div id="observablehq-brush_cell-db1bfa4f"></div>
        <div id="observablehq-violinplot_function_cell-db1bfa4f"></div>
        <div id="observablehq-BarChart-db1bfa4f"></div>
        <div id="observablehq-pallete-db1bfa4f"></div>
        <div id="observablehq-add_on_change_to_textual_filter-db1bfa4f"></div>
        <div id="observablehq-get_selected_foods-db1bfa4f"></div>
        <div id="observablehq-highlight_foods-db1bfa4f"></div>
        <div id="observablehq-highlight_color-db1bfa4f"></div>
        <div id="observablehq-change_linechart-db1bfa4f"></div>
        <div id="observablehq-LineChart3-db1bfa4f"></div>
        <div id="observablehq-macros_faixas-db1bfa4f"></div>
        <div id="observablehq-carboidratoFaixa-db1bfa4f"></div>
        <div id="observablehq-proteinaFaixa-db1bfa4f"></div>
        <div id="observablehq-gorduraFaixa-db1bfa4f"></div>
        <div id="observablehq-LineChartMacros-db1bfa4f"></div>
        <div id="observablehq-legenda-db1bfa4f"></div>
        <div id="observablehq-atualize_micronutrients-db1bfa4f"></div>
        <p>Credit: <a href="https://observablehq.com/d/dda5ba56ef8ee385@4363">Projeto Final - Visualização de Dados
                by
                Bruno Pereira Fornaro
                add
                Vanessa Berwanger Wille</a></p>
    </div>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@observablehq/inspector@5/dist/inspector.css">

    <!-- Link com o repositório do projeto no observable: https://observablehq.com/d/ffb89fcb60d326fa -->
    <script type="module">
        import { Runtime, Inspector } from "https://cdn.jsdelivr.net/npm/@observablehq/runtime@5/dist/runtime.js";
        import define from "https://api.observablehq.com/d/dda5ba56ef8ee385@4363.js?v=3";
        new Runtime().module(define, name => {
            if (name === "inserts_cell") return new Inspector(document.querySelector("#observablehq-inserts_cell-db1bfa4f"));
            if (name === "insert_atualize_barchart_cell") return new Inspector(document.querySelector("#observablehq-insert_atualize_barchart_cell-db1bfa4f"));
            if (name === "list_food_cell") return new Inspector(document.querySelector("#observablehq-list_food_cell-db1bfa4f"));
            if (name === "sliders_quantity_cell") return new Inspector(document.querySelector("#observablehq-sliders_quantity_cell-db1bfa4f"));
            if (name === "violinplot_cell") return new Inspector(document.querySelector("#observablehq-violinplot_cell-db1bfa4f"));
            if (name === "bar_chart_cell") return new Inspector(document.querySelector("#observablehq-bar_chart_cell-db1bfa4f"));
            if (name === "valor_energetico") return new Inspector(document.querySelector("#observablehq-valor_energetico-db1bfa4f"));
            if (name === "init_bar_chart_cell") return new Inspector(document.querySelector("#observablehq-init_bar_chart_cell-db1bfa4f"));
            if (name === "outputs_alimentos") return new Inspector(document.querySelector("#observablehq-outputs_alimentos-db1bfa4f"));
            if (name === "filter_food_to_bar_chart") return new Inspector(document.querySelector("#observablehq-filter_food_to_bar_chart-db1bfa4f"));
            if (name === "alimentos_selecionados") return new Inspector(document.querySelector("#observablehq-alimentos_selecionados-db1bfa4f"));
            if (name === "filtro_textual") return new Inspector(document.querySelector("#observablehq-filtro_textual-db1bfa4f"));
            if (name === "num_alimento") return new Inspector(document.querySelector("#observablehq-num_alimento-db1bfa4f"));
            if (name === "botao_confirmar") return new Inspector(document.querySelector("#observablehq-botao_confirmar-db1bfa4f"));
            if (name === "function_to_sliders_of_quantity_of_food_cell") return new Inspector(document.querySelector("#observablehq-function_to_sliders_of_quantity_of_food_cell-db1bfa4f"));
            if (name === "function_to_buttons_of_plus_and_less_selectors") return new Inspector(document.querySelector("#observablehq-function_to_buttons_of_plus_and_less_selectors-db1bfa4f"));
            if (name === "function_confirm_buttom") return new Inspector(document.querySelector("#observablehq-function_confirm_buttom-db1bfa4f"));
            if (name === "update_dropdown") return new Inspector(document.querySelector("#observablehq-update_dropdown-db1bfa4f"));
            if (name === "update_dropdown_cell") return new Inspector(document.querySelector("#observablehq-update_dropdown_cell-db1bfa4f"));
            if (name === "brush_cell") return new Inspector(document.querySelector("#observablehq-brush_cell-db1bfa4f"));
            if (name === "violinplot_function_cell") return new Inspector(document.querySelector("#observablehq-violinplot_function_cell-db1bfa4f"));
            if (name === "BarChart") return new Inspector(document.querySelector("#observablehq-BarChart-db1bfa4f"));
            if (name === "pallete") return new Inspector(document.querySelector("#observablehq-pallete-db1bfa4f"));
            if (name === "css_grafico_de_peso") return new Inspector(document.querySelector("#observablehq-css_grafico_de_peso-db1bfa4f"));
            if (name === "chart_peso") return new Inspector(document.querySelector("#observablehq-chart_peso-db1bfa4f"));
            //if (name === "div_pie_chart") return new Inspector(document.querySelector("#observablehq-div_pie_chart-db1bfa4f"));
            //if (name === "lipids_cell") return new Inspector(document.querySelector("#observablehq-lipids_cell-db1bfa4f"));
            //if (name === "minerals_cell") return new Inspector(document.querySelector("#observablehq-minerals_cell-db1bfa4f"));
            //if (name === "vitamins_cell") return new Inspector(document.querySelector("#observablehq-vitamins_cell-db1bfa4f"));
            if (name === "add_on_change_to_textual_filter") return new Inspector(document.querySelector("#observablehq-add_on_change_to_textual_filter-db1bfa4f"));
            if (name === "get_selected_foods") return new Inspector(document.querySelector("#observablehq-get_selected_foods-db1bfa4f"));
            if (name === "highlight_foods") return new Inspector(document.querySelector("#observablehq-highlight_foods-db1bfa4f"));
            if (name === "highlight_color") return new Inspector(document.querySelector("#observablehq-highlight_color-db1bfa4f"));
            if (name === "change_linechart") return new Inspector(document.querySelector("#observablehq-change_linechart-db1bfa4f"));
            if (name === "LineChart3") return new Inspector(document.querySelector("#observablehq-LineChart3-db1bfa4f"));
            if (name === "macros_faixas") return new Inspector(document.querySelector("#observablehq-macros_faixas-db1bfa4f"));
            if (name === "carboidratoFaixa") return new Inspector(document.querySelector("#observablehq-carboidratoFaixa-db1bfa4f"));
            if (name === "proteinaFaixa") return new Inspector(document.querySelector("#observablehq-proteinaFaixa-db1bfa4f"));
            if (name === "gorduraFaixa") return new Inspector(document.querySelector("#observablehq-gorduraFaixa-db1bfa4f"));
            if (name === "LineChartMacros") return new Inspector(document.querySelector("#observablehq-LineChartMacros-db1bfa4f"));
            if (name === "legenda") return new Inspector(document.querySelector("#observablehq-legenda-db1bfa4f"));
            if (name === "atualize_micronutrients") return new Inspector(document.querySelector("#observablehq-atualize_micronutrients-db1bfa4f"));
            return ["chart_peso", "chart_carb", "chart_prot", "chart_lip", "legenda_peso", "add_selector", "violinplot_function_cell", "MatrixChart", "brush_cell"].includes(name);

        });
    </script>
    <!-- Versão -->
    <!-- id: db1bfa4f -->
    <!-- commit: 4363 -->
</body>